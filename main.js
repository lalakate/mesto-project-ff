(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-39",headers:{authorization:"f3cecd4a-71ec-481b-9efc-253692d3635d","Content-Type":"application/json"}},t=function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))},n=function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))},o=function(t,n){(function(t){return fetch("".concat(e.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))})(n).then((function(){t.remove()}))},c=function(e){var o=e.dataset.cardId;(e.classList.contains("card__like-button_is-active")?n:t)(o).then((function(t){var n=String(window.currentUserId);t.likes.some((function(e){return String(e._id)===n}))?e.classList.add("card__like-button_is-active"):e.classList.remove("card__like-button_is-active"),e.closest(".card").querySelector(".card__like-count").textContent=t.likes.length,e.dataset.cardId=t._id})).catch((function(e){console.log(e)}))},r=function(e,t,n,o,c,r,u,i){var s=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),l=s.querySelector(".card__image"),d=s.querySelector(".card__title"),p=s.querySelector(".card__delete-button"),f=s.querySelector(".card__like-button"),_=s.querySelector(".card__like-count");return l.src=e.link,l.alt=e.name,d.textContent=e.name,_.textContent=e.likes.length,e.owner&&e.owner._id===i?p.addEventListener("click",(function(){return t(s,e._id)})):p.style.display="none",f.dataset.cardId=e._id,f.addEventListener("click",(function(){return o(f)})),l.addEventListener("click",(function(){return a(e,c,r,u,n)})),e.likes.some((function(e){return String(e._id)===String(i)}))?f.classList.add("card__like-button_is-active"):f.classList.remove("card__like-button_is-active"),s},a=function(e,t,n,o,c){t.src=e.link,t.alt=e.name,n.textContent=e.name,c(o)},u=function(e,t){var n=document.getElementById("".concat(t.id,"-error"));t.classList.remove("popup__input_type_error"),n.classList.remove("popup__input-error_active"),n.textContent=""},i=function(){Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");s(t,n),t.forEach((function(e){e.addEventListener("input",(function(){(function(e,t){t.validity.valid?u(0,t):function(e,t,n){var o=document.getElementById("".concat(t.id,"-error"));t.classList.add("popup__input_type_error"),o.textContent=n,o.classList.add("popup__input-error_active")}(0,t,t.dataset.errorMessage||t.validationMessage)})(0,e),s(t,n)}))}))}(e)}))},s=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove("popup__button_disabled"):t.classList.add("popup__button_disabled")},l=null,d=function(e){l&&p(l),e.classList.add("popup_is-animated"),e.offsetWidth,e.classList.add("popup_is-opened"),l=e,document.addEventListener("keydown",f),e.addEventListener("click",_),i();var t=e.querySelector(".popup__form");t&&function(e){var t=Array.from(e.querySelectorAll(".popup__input"));t.forEach((function(e){u(0,e)}));var n=e.querySelector(".popup__button");s(t,n)}(t)},p=function(e){e.classList.remove("popup_is-opened"),l=null,document.removeEventListener("keydown",f),e.removeEventListener("click",_)},f=function(e){"Escape"===e.key&&l&&p(l)},_=function(e){e.target===l&&p(l)},m=document.querySelector(".profile__edit-button"),v=document.querySelector(".profile__add-button"),h=document.querySelector(".popup_type_edit"),y=document.querySelector(".popup_type_edit-avatar"),k=document.querySelector(".popup_type_new-card"),b=document.querySelector(".popup_type_image"),S=b.querySelector(".popup__image"),g=b.querySelector(".popup__caption"),q=document.querySelectorAll(".popup__close"),L=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),C=document.forms["edit-profile"],x=document.forms["new-place"],j=document.forms["edit-avatar"],w=document.querySelector(".profile__image__edit-button"),U=document.querySelector(".places__list");m.addEventListener("click",(function(){C.name.value=L.textContent,C.description.value=E.textContent,d(h)})),w.addEventListener("click",(function(){j.avatar.value="",d(y)})),v.addEventListener("click",(function(){return d(k)})),q.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return p(t)}))})),C.addEventListener("submit",(function(t){t.preventDefault();var n,o,c=C.querySelector(".popup__button"),r=c.textContent;c.textContent="Сохранение...",(n=C.name.value,o=C.description.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(){L.textContent=C.name.value,E.textContent=C.description.value,p(h)})).catch((function(e){console.log(e)})).finally((function(){c.textContent=r}))})),x.addEventListener("submit",(function(t){t.preventDefault();var n,a,u={name:x["place-name"].value,link:x.link.value},i=createFormForm.querySelector(".popup__button"),s=i.textContent;i.textContent="Сохранение...",(n=u.name,a=u.link,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:n,link:a})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){var t=r(e,o,d,c,S,g,b,window.currentUserId);U.prepend(t),p(k)})).catch((function(e){console.log(e)})).finally((function(){i.textContent=s}))})),j.addEventListener("submit",(function(t){t.preventDefault();var n=j.avatar.value;j.avatar.value="";var o=j.querySelector(".popup__button"),c=o.textContent;o.textContent="Сохранение...",function(t){return fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(n).then((function(e){document.querySelector(".profile__image").style.backgroundImage="url('".concat(e.avatar,"')"),p(y)})).catch((function(e){console.log(e)})).finally((function(){o.textContent=c}))})),fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).then((function(t){L.textContent=t.name,E.textContent=t.about,window.currentUserId=t._id,document.querySelector(".profile__image").style.backgroundImage="url('".concat(t.avatar,"')"),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).then((function(e){e.forEach((function(e){var t=r(e,o,d,c,S,g,b,window.currentUserId);U.append(t)}))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))})();